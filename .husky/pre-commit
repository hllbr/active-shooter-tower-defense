#!/usr/bin/env sh

echo "üîç Running pre-commit checks..."

# Check for console and logger statements in staged files (excluding GameDebugTools)
echo "üîç Checking for console/log statements..."
CONSOLE_CHECK=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx)$' | grep -v 'GameDebugTools' | xargs grep -l -E 'console\.(log|warn|error|assert|info|debug)|logger\.(debug|info|warn|error|log)' 2>/dev/null || true)

if [ ! -z "$CONSOLE_CHECK" ]; then
  echo "‚ùå Commit blocked: Remove all console or logger statements before committing."
  echo "Files with console/log statements:"
  echo "$CONSOLE_CHECK"
  exit 1
fi

# Run type check first
echo "üìù Type checking..."
npm run type-check
TYPE_CHECK_EXIT_CODE=$?

if [ $TYPE_CHECK_EXIT_CODE -ne 0 ]; then
  echo "‚ùå Type check failed! Commit blocked."
  exit 1
fi

# Run linting with warnings allowed (temporarily disabled for Task 13)
echo "üîç Linting (temporarily disabled for Task 13)..."
# npm run lint:check
# LINT_EXIT_CODE=$?

# if [ $LINT_EXIT_CODE -ne 0 ]; then
#   echo "‚ùå Linting failed with errors! Commit blocked."
#   exit 1
# fi

echo "‚úÖ Pre-commit checks passed! Commit allowed."
